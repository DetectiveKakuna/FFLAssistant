@using FFLAssistant.Models
@using FFLAssistant.Models.Enums
@using MudBlazor

<MudCard Class="position-rankings-card" Style="@GetCardStyle()">
    <MudCardContent Class="pa-2">
        <!-- Title -->
        <MudText Typo="Typo.h6"
                 Class="text-center mb-2"
                 Align="Align.Center"
                 Style="@GetTitleStyle()">
            @Title
        </MudText>

        @if (!IsExpanded)
        {
            <!-- Compact View -->
            <div style="min-height: 120px;">
                @{
                    var availablePlayers = FilteredRankings.Where(r => !r.IsDrafted).Take(DefaultDisplay).ToList();
                }

                @foreach (var ranking in availablePlayers)
                {
                    <MudText Typo="Typo.body2"
                             Class="mb-1 px-5"
                             Style="@GetPlayerTextStyle()">
                        @($"{ranking.OverallRank}. {ranking.Player.FullName} - {ranking.Player.Team}")
                    </MudText>
                }

                @if (availablePlayers.Count == 0)
                {
                    <MudText Typo="Typo.body2"
                             Class="text-center mt-4"
                             Style="@GetEmptyTextStyle()">
                        No available players
                    </MudText>
                }
            </div>

            <!-- Expand Button -->
            <div class="text-center mt-2">
                <MudIconButton Icon="Icons.Material.Filled.KeyboardArrowDown"
                               Size="Size.Small"
                               Color="Color.Surface"
                               OnClick="ToggleExpanded"
                               Style="@GetArrowButtonStyle()" />
            </div>
        }
        else
        {
            <!-- Expanded View -->
            <div style="height: 50vh; overflow-y: auto;">
                @foreach (var ranking in FilteredRankings)
                {
                    <MudText Typo="Typo.body2"
                             Class="mb-1 px-5"
                             Style="@GetPlayerTextStyle(ranking.IsDrafted)">
                        @($"{ranking.OverallRank}. {ranking.Player.FullName} - {ranking.Player.Team}")
                    </MudText>
                }

                @if (!FilteredRankings.Any())
                {
                    <MudText Typo="Typo.body2"
                             Class="text-center mt-4"
                             Style="@GetEmptyTextStyle()">
                        No players available
                    </MudText>
                }
            </div>

            <!-- Collapse Button -->
            <div class="text-center mt-2">
                <MudIconButton Icon="Icons.Material.Filled.KeyboardArrowUp"
                               Size="Size.Small"
                               Color="Color.Surface"
                               OnClick="ToggleExpanded"
                               Style="@GetArrowButtonStyle()" />
            </div>
        }
    </MudCardContent>
</MudCard>